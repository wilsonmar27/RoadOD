class LabelCounter:
    def __init__(self, adir):
        self.labels = get_labels(adir)
        self.files = [fix_path(file_path) for file_path in iglob(os.path.join(adir, "*.txt"))]
        self.total_files = len(self.files)

        # create a dict where keys are from the list labels and all the values are 0
        self.label_dict = dict.fromkeys(self.labels, 0)
        self.empty_files = 0
        self.bad_labels = None

        if check_for_wrong_labels(self.labels) is not None:
            self.bad_labels = set(check_for_wrong_labels(self.labels))

    def count(self):
        if self.bad_labels is None:
            for path in self.files:
                if os.path.getsize(path) == 0:  # if file is empty pass
                    self.empty_files += 1
                else:
                    f = open(path, 'r')
                    lines = f.readlines()
                    f.close()
                    for line in lines:
                        for label in self.labels:
                            if self.labels[int(line[0])] == label:
                                self.label_dict[label] += 1
        else:
            for path in self.files:
                if os.path.getsize(path) == 0:  # if file is empty pass
                    self.empty_files += 1
                else:
                    f = open(path, 'r')
                    lines = f.readlines()
                    f.close()
                    for line in lines:
                        for label in self.labels:
                            if self.labels[int(line[0])] == label and self.labels[int(line[0])] not in self.bad_labels:
                                self.label_dict[label] += 1
                        if self.labels[int(line[0])] in self.bad_labels:
                            print("[WARNING] label {} not in ditionary found in file {}"
                                  .format(self.labels[int(line[0])], path))

        return self.label_dict


print("[INFO] Searching for text files")

if get_immediate_subdirectories(search_dir) is None:
    find_label = LabelCounter(search_dir)

    print("[INFO] Searching for labels in text files")
    found_labels_dict = find_label.count()

    total = find_label.total_files
    empty = find_label.empty_files

    print("[INFO] Ploting data")
    plot(found_labels_dict, total, empty)

else:
    sub_dir = get_immediate_subdirectories(search_dir)
    total = 0
    empty = 0
    final_dict = dict()
    for folder in sub_dir:
        new_search = os.path.join(search_dir, folder)
        find_label = LabelCounter(new_search)

        print("[INFO] Searching for labels in text files in {}".format(new_search))
        found_labels_dict = find_label.count()
        total = total + find_label.total_files
        empty = empty + find_label.empty_files
        final_dict = add_dict(final_dict, found_labels_dict)

    print("[INFO] Ploting data")
    plot(final_dict, total, empty)